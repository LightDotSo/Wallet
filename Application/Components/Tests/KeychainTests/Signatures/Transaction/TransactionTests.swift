import BigInt
import Commons
import CryptoSwift
import Domain
import XCTest

@testable import Keychain

class TransactionTests: XCTestCase {

  func test_goerli_contract_result() throws {
    let transaction = TransactionRequest(
      to: try EthereumAddress(hex: "0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45"),
      value: Quantity(bigInteger: 0x23_86f2_6fc1_0000),
      gasPrice: Quantity(bigInteger: 0x2_f903_5b3b),
      gas: Quantity(bigInteger: 0x44615ba),
      nonce: Quantity(bigInteger: 0x26),
      chainId: Quantity(bigInteger: 0x5),
      data: Data(
        hex:
          "0x5ae401dc00000000000000000000000000000000000000000000000000000000634e138000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000b4fbf271143f4fbf7b91a5ded31805e42b2208d60000000000000000000000001f9840a85d5af5bf1d1762f925bdaddc4201f98400000000000000000000000000000000000000000000000000000000000001f400000000000000000000000014791697260e4c9a71f18484c9f997b308e59325000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000030cbc199a4eaef000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
      )
    )
    let signed = try TransactionRequestSignature(storage: SecureStorageMock()).signed(
      with: transaction, wallet: EthereumWallet.walletDefault())
    let encodedSignature = try RLPEncoder().encode(transaction.rlp() + signed.rlp())

    XCTAssertEqual(
      encodedSignature.hex(),
      "0xf90213268502f9035b3b84044615ba9468b3465833fb72a70ecdf485e0e4c7bd8665fc45872386f26fc10000b901a45ae401dc00000000000000000000000000000000000000000000000000000000634e138000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000b4fbf271143f4fbf7b91a5ded31805e42b2208d60000000000000000000000001f9840a85d5af5bf1d1762f925bdaddc4201f98400000000000000000000000000000000000000000000000000000000000001f400000000000000000000000014791697260e4c9a71f18484c9f997b308e59325000000000000000000000000000000000000000000000000002386f26fc100000000000000000000000000000000000000000000000000000030cbc199a4eaef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002ea0c23a516cad1f0bb0ac3ad238cacf8b7db99ec77e568c24f439ceda7148673217a02e8969f24db98f157a4014a7f88083f8938b3c5c737dc3a2fda3d41b66dc62fb"
    )
  }
}
